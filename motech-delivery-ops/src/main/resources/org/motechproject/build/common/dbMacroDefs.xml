<?xml version="1.0" encoding="UTF-8"?>
<antlib xmlns:flyway="antlib:com.googlecode.flyway.ant">
    <macrodef name="migrate.using.flyway">
        <attribute name="schemas"/>
        <attribute name="migrationDir"/>
        <attribute name="dbDriver"/>
        <attribute name="dbJdbcUrl"/>
        <attribute name="user"/>
        <attribute name="password"/>
        <sequential>
            <tempfile property="temp.migration.dir" destDir="." prefix="migration"/>
            <mkdir dir="${temp.migration.dir}"/>
            <basename property="temp.migration.dir.name.without.path" file="${temp.migration.dir}"/>

            <copy todir="${temp.migration.dir}">
                <fileset dir="@{migrationDir}" />
            </copy>

            <property name="flyway.schemas" value="@{schemas}" />
            <property name="flyway.baseDir" value="${temp.migration.dir.name.without.path}/"/>
            <property name="flyway.driver" value="@{dbDriver}"/>
            <property name="flyway.url" value="@{dbJdbcUrl}"/>
            <property name="flyway.user" value="@{user}"/>
            <property name="flyway.password" value="@{password}"/>
            <flyway:migrate />
        </sequential>
    </macrodef>

    <macrodef name="cleanup.database.using.flyway">
        <attribute name="dbDriver"/>
        <attribute name="dbJdbcUrl"/>
        <attribute name="user"/>
        <attribute name="password"/>
        <attribute name="schemas"/>
        <sequential>
            <property name="flyway.schemas" value="@{schemas}" />
            <property name="flyway.driver" value="@{dbDriver}"/>
            <property name="flyway.url" value="@{dbJdbcUrl}"/>
            <property name="flyway.user" value="@{user}"/>
            <property name="flyway.password" value="@{password}"/>
            <flyway:clean/>
        </sequential>
    </macrodef>


</antlib>
